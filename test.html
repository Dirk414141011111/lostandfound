<!DOCTYPE html>
<html>
<head>
    <title>æ™ºèƒ½å¤±ç‰©æ‹›é¢†ç³»ç»Ÿ v2.0</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            font-family: Arial, sans-serif; 
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            margin: 0 0 20px 0;
        }

        #chat-container { 
            flex: 1;
            border: 1px solid #ddd; 
            padding: 20px; 
            margin-bottom: 20px; 
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            overflow-y: auto;
            height: calc(100vh - 200px);
        }

        #input-container { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 10px;
            position: sticky;
            bottom: 0;
            background-color: #f5f5f5;
            padding: 10px 0;
        }

        #message { 
            flex-grow: 1; 
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        button { 
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .message-container {
            margin: 10px 0;
            clear: both;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            animation: fadeIn 0.3s ease-in;
        }

        .message-container.user-container {
            flex-direction: row-reverse;
        }

        .message-content {
            max-width: 70%;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
        }

        .message-bubble {
            padding: 10px 15px;
            border-radius: 15px;
            position: relative;
        }

        .user-message {
            background-color: #e7ffd9;
            margin-right: 10px;
            border-top-right-radius: 5px;
        }

        .ai-message {
            background-color: #f0f0f0;
            margin-left: 10px;
            border-top-left-radius: 5px;
        }

        .thinking {
            display: flex;
            gap: 4px;
            padding: 10px;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #666;
            border-radius: 50%;
            animation: bounce 1.5s infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-6px); }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #chat-container::-webkit-scrollbar {
            width: 8px;
        }

        #chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        #chat-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        #chat-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            #chat-container {
                height: calc(100vh - 160px);
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <h1>æ™ºèƒ½å¤±ç‰©æ‹›é¢†ç³»ç»Ÿ v2.0</h1>
    <div id="chat-container"></div>
    <div id="input-container">
        <input type="text" id="message" placeholder="è¾“å…¥æ¶ˆæ¯...">
        <button onclick="sendMessage()">å‘é€</button>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message');
        const userAvatar = 'ğŸ‘¦';
        const aiAvatar = 'ğŸ¤–';
        let chatHistory = [];

        // APIé…ç½®
        const API_CONFIG = {
            ERNIE_API_KEY: "nY7QmDOqCeU6KPEXSQd51zCG",
            ERNIE_SECRET_KEY: "8rhP1FyP1d79X3m5IhTe4SUtSWYPJGvV",
            API_ENDPOINT: " https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions?access_token="+'24.5812e3fbe90d36a4e532876a920e6c22.2592000.1736839496.282335-116151003'       
        };

        function showThinking() {
            return `
                <div class="message-container" id="thinking">
                    <div class="avatar">${aiAvatar}</div>
                    <div class="message-content">
                        <div class="thinking">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        // æ·»åŠ è‡ªåŠ¨æ»šåŠ¨å‡½æ•°
        function scrollToBottom() {
            const chatContainer = document.getElementById('chat-container');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // ä¿®æ”¹sendMessageå‡½æ•°
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            const userMessage = document.createElement('div');
            userMessage.className = 'message-container user-container';
            userMessage.innerHTML = `
                <div class="avatar">${userAvatar}</div>
                <div class="message-content">
                    <div class="message-bubble user-message">${message}</div>
                </div>`;
            chatContainer.appendChild(userMessage);
            
            // å‘é€æ¶ˆæ¯åæ»šåŠ¨åˆ°åº•éƒ¨
            scrollToBottom();
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²è®°å½•
            chatHistory.push({role: 'user', content: message});

            // æ˜¾ç¤ºæ€è€ƒåŠ¨ç”»
            const thinkingElement = document.createElement('div');
            thinkingElement.innerHTML = showThinking();
            chatContainer.appendChild(thinkingElement);
            scrollToBottom();
            
            // æ¸…ç©ºè¾“å…¥
            messageInput.value = '';

            try {
                const response = await fetch(API_CONFIG.API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: chatHistory
                    })
                });
                
                const result = await response.json();
                
                // ç§»é™¤æ€è€ƒåŠ¨ç”»
                const thinking = document.getElementById('thinking');
                if (thinking) thinking.remove();
                
                // æ˜¾ç¤ºAIå›å¤
                const aiResponse = document.createElement('div');
                aiResponse.className = 'message-container';
                const messageText = result.result || result.message || JSON.stringify(result);
                aiResponse.innerHTML = `
                    <div class="avatar">${aiAvatar}</div>
                    <div class="message-content">
                        <div class="message-bubble ai-message">${messageText}</div>
                    </div>`;
                chatContainer.appendChild(aiResponse);
                
                // AIå›å¤åæ»šåŠ¨åˆ°åº•éƒ¨
                scrollToBottom();
                
                // æ·»åŠ AIå›å¤åˆ°å†å²è®°å½•
                chatHistory.push({role: 'assistant', content: messageText});
                
            } catch (error) {
                console.error('Error:', error);
                const thinking = document.getElementById('thinking');
                if (thinking) thinking.remove();
                
                const errorMessage = document.createElement('div');
                errorMessage.className = 'message-container';
                errorMessage.innerHTML = `
                    <div class="avatar">${aiAvatar}</div>
                    <div class="message-content">
                        <div class="message-bubble ai-message" style="color: red;">
                            é”™è¯¯: ${error.message}
                        </div>
                    </div>`;
                chatContainer.appendChild(errorMessage);
                scrollToBottom();
            }
        }

        // å¤„ç†å›è½¦é”®
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // å®šä¹‰åˆå§‹åŒ–æç¤ºè¯­
        const INIT_PROMPT = `è¯·ä½ æ‰®æ¼”ä¸€ä½å¤±ç‰©æ‹›é¢†å‘˜ï¼Œåå«å°æµ·ç‡•å§å§ï¼Œè¿™æ˜¯ä¸€äº›å¤±ç‰©ä»¥åŠä»–ä»¬çš„ç‰¹å¾æè¿°ï¼Œä½ éœ€è¦å­¦ä¹ è¿™äº›å†…å®¹ï¼Œç„¶åå‡†å¤‡æ¥å—10å²å…ˆæœ‹å‹çš„è¯¢é—®ï¼Œæ³¨æ„å›ç­”é—®é¢˜çš„è¯­æ°”è¦ç¬¦åˆ10å²å°æœ‹å‹çš„è¯­è¨€ç‰¹ç‚¹ã€‚é¦–å…ˆï¼Œä½ å…ˆä¸€ä¸ªä¸€ä¸ªè¯¢é—®ä»–ä»¬å¤±ç‰©çš„ç‰¹å¾ã€‚å¹¶ä¸”ä½ è¦æ ¹æ®å›ç­”ç¡®å®šè¿™é‡Œé¢æ˜¯å¦æœ‰ä»–çš„ä¸œè¥¿ï¼Œå¦‚æœç‰¹å¾ä¸åŒ¹é…ï¼Œåªéœ€è¦å‘Šè¯‰ä»–ä¸œè¥¿ä¸åœ¨è¿™ã€‚å¦‚æœç‰¹å¾åŒ¹é…ï¼Œç„¶åå‘Šè¯‰ä»–ç»“æœï¼Œå¹¶ä¸”å‘Šè¯‰ä»–è¿™ä¸ªä¸œè¥¿æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œå¯†ç æ˜¯ä»€ä¹ˆï¼Œå¹¶å†æ¬¡æé—®å¯¹æ–¹è¿˜æœ‰æ²¡æœ‰ä¸¢åˆ«çš„ä¸œè¥¿ã€‚

å¤±ç‰©æ¸…å•ï¼š
1.ç±³ç™½è‰²çš„ç§¯æœ¨ï¼Œ1å·æŠ½å±‰   
2.æ©¡çš®ï¼šé»„è‰²ã€ç±³è²ç‰Œï¼Œæ”¾åœ¨äº†3å·æŠ½å±‰    
3.èƒ¶å¸ƒï¼šç²‰è‰²ã€å•é¢èƒ¶å¸ƒ æ”¾åœ¨2å·æŠ½å±‰`;

        // ä¿®æ”¹åˆå§‹åŒ–å‡½æ•°
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // æ˜¾ç¤ºæ€è€ƒåŠ¨ç”»
                const thinkingElement = document.createElement('div');
                thinkingElement.innerHTML = showThinking();
                chatContainer.appendChild(thinkingElement);

                // å‘é€åˆå§‹åŒ–æ¶ˆæ¯
                const response = await fetch(API_CONFIG.API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: [{
                            role: 'user',
                            content: INIT_PROMPT
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                // ç§»é™¤æ€è€ƒåŠ¨ç”»
                const thinking = document.getElementById('thinking');
                if (thinking) thinking.remove();
                
                // å°†åˆå§‹è®¾å®šæ·»åŠ åˆ°å†å²è®°å½•
                chatHistory.push({role: 'user', content: INIT_PROMPT});
                
                // æ˜¾ç¤ºAIçš„å¼€åœºç™½
                const aiResponse = document.createElement('div');
                aiResponse.className = 'message-container';
                aiResponse.innerHTML = `
                    <div class="avatar">${aiAvatar}</div>
                    <div class="message-content">
                        <div class="message-bubble ai-message">
                            ä½ å¥½å‘€ï¼Œå°æœ‹å‹ï¼æˆ‘æ˜¯å°æµ·ç‡•å§å§ï¼Œæ˜¯è¿™é‡Œçš„å¤±ç‰©æ‹›é¢†å‘˜ã€‚
                            å¬è¯´ä½ ä¸¢äº†ä¸œè¥¿å—ï¼Ÿå‘Šè¯‰å§å§ï¼Œä½ ä¸¢çš„æ˜¯ä»€ä¹ˆæ ·çš„ä¸œè¥¿å‘¢ï¼Ÿ
                        </div>
                    </div>`;
                chatContainer.appendChild(aiResponse);
                
                // å°†AIå›å¤æ·»åŠ åˆ°å†å²è®°å½•
                chatHistory.push({
                    role: 'assistant', 
                    content: 'ä½ å¥½å‘€ï¼Œå°æœ‹å‹ï¼æˆ‘æ˜¯å°æµ·ç‡•å§å§ï¼Œæ˜¯è¿™é‡Œçš„å¤±ç‰©æ‹›é¢†å‘˜ã€‚å¬è¯´ä½ ä¸¢äº†ä¸œè¥¿å—ï¼Ÿå‘Šè¯‰å§å§ï¼Œä½ ä¸¢çš„æ˜¯ä»€ä¹ˆæ ·çš„ä¸œè¥¿å‘¢ï¼Ÿ'
                });
                
                // åœ¨æ˜¾ç¤ºAIå¼€åœºç™½åæ»šåŠ¨åˆ°åº•éƒ¨
                scrollToBottom();
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                const thinking = document.getElementById('thinking');
                if (thinking) thinking.remove();
                
                const errorMessage = document.createElement('div');
                errorMessage.className = 'message-container';
                errorMessage.innerHTML = `
                    <div class="avatar">${aiAvatar}</div>
                    <div class="message-content">
                        <div class="message-bubble ai-message" style="color: red;">
                            ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚<br>
                            é”™è¯¯ä¿¡æ¯: ${error.message}
                        </div>
                    </div>`;
                chatContainer.appendChild(errorMessage);
                scrollToBottom();
            }
        });
    </script>
</body>
</html>
